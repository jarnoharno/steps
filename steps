#!/usr/bin/env groovy

if (!args) {
  println 'Usage: steps args...'
  System.exit(1)
}

def run(Object... args) {
  args.join(' ').execute()
}

def adb = 'adb'

def devices = run(adb, 'devices').text.split('\n').drop(1)
  .collect({ it.split()[0] })

adb += ' -s ' + devices[0]

def storage = run(adb, 'shell echo \$EXTERNAL_STORAGE').text.trim()
storage += '/Android/data/com.hiit.steps/files'

switch (args[0]) {
case 'pull':
  def pulls = args.drop(1).collect({ storage + '/' + it })
  if (!pulls)
    pulls = [ storage ]
  pulls.each({
    print(run(adb, 'pull', it, 'data').err.text)
  })
  break
default:
  print(run(adb, 'shell cd', storage, '&&', *args).text)
}
